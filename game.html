<!DOCTYPE html>
<html lang = de>
<head>
	<Title>AVPRG</title>
    <meta charset=utf-8>
    <link rel=stylesheet href=stylesheet.css type=text/css>
</head>
<body>
    <canvas id=canvas width=1200 height=800></canvas>
    <script>
        const FPS = 30;
        const playerSize = 70;
        const testpoint = 100;
        const platformAmount = 10;
        const scrollSpeed = 10;
        var indicatorPosition = 0;
        var message = "Press F to hit the gap";
        var cooldown = false;
        var activeGap = 0;
        var firstClickDone = false;
        var score = 0;

        var canv = document.getElementById("canvas");
        var ctx = canv.getContext("2d");
        
        ctx.font = "20px Arial";

        var player = 
        {
            x: canv.width / 8,
            y: canv.height / 2,
            width: playerSize,
            height: playerSize * 1.5
        }

        var platforms = [];

        //Gameloop
        setInterval(update, 1000 / FPS);

        createFloor();
        indicatorPosition = player.x * 2.2;

        function update()
        {
            //message = activeGap;
            
            
            //draw background
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canv.width, canv.height);

            //draw backgroundplatform
            ctx.fillStyle = "white";
            ctx.fillRect(0, player.y+playerSize / 20, canv.width, 30);

            //draw text
            ctx.fillStyle = "white";
            ctx.fillText(message, canv.width - 400, 50);

            //draw player
            ctx.fillStyle = "green";
            ctx.fillRect(player.x, player.y - player.height, player.width, player.height);
            ctx.strokeStyle = "white";
            ctx.lineWidth = playerSize / 20;
            ctx.beginPath();
            ctx.moveTo(player.x, player.y);
            ctx.lineTo(player.x + player.width, player.y);
            ctx.lineTo(player.x + player.width, player.y - player.height);
            ctx.lineTo(player.x, player.y - player.height);
            ctx.lineTo(player.x, player.y);

            ctx.stroke();

            //calculate new platform position
            calcFloor();
            calcNextGap();

            //draw platform
            for(var i = 0; i < platformAmount; i++)
            {
                if(i % 2 == 1)ctx.fillStyle = "blue";
                else if(i % 2 == 0)ctx.fillStyle = "red";
                
                ctx.fillRect(platforms[i], player.y+playerSize / 20, testpoint, 30);
            }

            //draw indicator
            ctx.strokeStyle = "red";
            ctx.lineWidth = playerSize / 10;
            ctx.beginPath();
            ctx.moveTo(player.x * 2.2, player.y - player.height * 1.5);
            ctx.lineTo(player.x * 2.2, player.y + player.height / 2);

            ctx.stroke();
        }

        window.onkeydown = function(e)
        {
            var key = e.keyCode ? e.keyCode : e.which;

            if(key == 70 && activeGap % 2 == 1)
            {
                checkHit();
            }
            if(key == 74 && activeGap % 2 == 0)
            {
                checkHit();
            }
        }

        function createFloor()
        {
            for(var i = 0; i < platformAmount; i++)
            {
                platforms[i] = 600 + (i * 305);
            }
        }
        function calcFloor()
        {
            for(var i = 0; i < platformAmount; i++)
            {
                platforms[i] = platforms[i] - scrollSpeed;
            }
        }
        function checkHit()
        {
            var hitError;
            var points;
            var rewardMessage;
            
            if(indicatorPosition > platforms[activeGap] -51 && indicatorPosition < platforms[activeGap] +51)
            {
                if(cooldown == false)
                {
                    hitError = indicatorPosition - platforms[activeGap];
                    if(Math.abs(hitError) < 11)
                    {
                        points = 300;
                        rewardMessage = "Perfect Hit!";
                    }
                    else if(Math.abs(hitError) < 21)
                    {
                        points = 100;
                        rewardMessage = "Good Hit!";
                    }
                    else if(Math.abs(hitError) < 31)
                    {
                        points = 50;
                        rewardMessage = "Poor Hit!";
                    }
                    else
                    {
                        points = 0;
                        rewardMessage = "Miss!";
                    }
                    score += points;
                    message = hitError + " = " + rewardMessage + " (" + points + ") ----- Score: " + score;
                    cooldown = true;
                }
            }
            
        }
        function calcNextGap()
        {
            if((platforms[activeGap] + (platforms[activeGap + 1] - platforms[activeGap]) / 2) < indicatorPosition)
            {
                if(firstClickDone == false)
                {
                    activeGap++;
                    cooldown = false;
                }
            }
        }
	    
	    //Play Soundfile
        /*document.getElementById("Button1").addEventListener("click", function() {
        
        document.getElementById("outputText").innerHTML = "Test1";
        var context = new AudioContext(),
        sound = new Audio("sounds/sound1.wav"),
        soundNote = context.createMediaElementSource(sound);
        var gainNode = context.createGain();
        gainNode.gain.value = 0.8;
        soundNote.connect(gainNode);
        gainNode.connect(context.destination);
        sound.play();
        }); */
	    
	    // oscillator
	    
	  /*  var context = new AudioContext();
	var oscillatorNode = context.createOscillator();
	oscillatorNode.connect(context.destination);
	oscillatorNode.frequency.value = 880;
	oscillatorNode.type = "square";
	oscillatorNode.start(context.currentTime);
	oscillatorNode.stop(context.currentTime + 1);*/
	    
	// oscillator + gain
	    
	   /*var context = new AudioContext();
		var oscillatorNode = context.createOscillator();
		var gainNode = context.createGain();
		oscillatorNode.connect(gainNode);
	    	oscillatorNode.frequency.value = 880;
		oscillatorNode.type = "square";
		gainNode.connect(context.destination);
		gainNode.gain.value = 0.001;
		oscillatorNode.start(context.currentTime);
		oscillatorNode.stop(context.currentTime + 1);*/
	    
	    
	    //Theremin
	  /* var context = new AudioContext();
		oscillator = null
		mousedown = false
		gainNode = context.createGain();
	    document.body.addEventListener('mousedown', function(e){
		mousedown = true;
		oscillator = context.createOscillator();
		oscillator.connect(gainNode);
		gainNode.connect(context.destination);
		calculateFreqAndGain(e);
		oscillator.start(context.currentTime);
	    });
	    
	 function calculateFreqAndGain(e) {
		var maxFreq = 2000;
		    minFreq = 20;
		    maxGain = 1;
		    minGain = 0;
		oscillator.frequency.value = (((e.clientX / window.innerWidth) * maxFreq) + minFreq);
		gainNode.gain.value = (((e.clientY / window.innerHeight) * maxGain) + minGain);
		 
		oscillator.frequency.setTargetAtTime((((e.clientX / window.innerWidth) * maxFreq) + minFreq), context.currentTime, 0.01);
	    }*/
	    
    </script>
</body>
</html>
